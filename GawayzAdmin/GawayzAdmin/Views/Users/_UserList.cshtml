@using PagedList
@using PagedList.Mvc

<div id="usersTable">
    <div class="content-box-large">
        <div class="panel-heading">
            <div class="panel-title"><h2>User</h2></div>
        </div>
        <div class="panel-body">
            <div class="table-responsive">

                <table class="table">
                    <tr>
                        <th>
                            <strong> User Name</strong>
                        </th>
                        
                        <th>
                            <strong>Active</strong>
                        </th>
                        <th>Action</th>
                    </tr>

                    @foreach (var item in ViewBag.OnePageOfusers)
                    {
                        <tr>
                            <td>
                                @item.UserName
                            </td>
                           
                            <td>
                                @if (item.IsActive == true)
                                {
                                    <span class="label label-success">Active</span>

                                }
                                else
                                {
                                    <span class="label label-danger">Inactive</span>

                                }
                            </td>
                            <td>
                                @Html.ActionLink("Edit", "Edit", new { id = @item.UserId}, new { @class = "btn btn-warning btn-xs", data_modal = "" }) |




                            </td>
                        </tr>
                    }

                </table>
                @Html.PagedListPager((IPagedList)ViewBag.OnePageOfusers, page => Url.Action("UserList", new { page }), PagedListRenderOptions.EnableUnobtrusiveAjaxReplacing(new AjaxOptions() { HttpMethod = "GET", UpdateTargetId = "usersTable" }))
            </div>
        </div>
    </div>
</div>

<script>
    var resultVariable;
    $(function() {
        $.ajaxSetup({ cache: false, async:false });

        $("a[data-modal]")
            .on("click",
                function(e) {
                    // hide dropdown if any (this is used wehen invoking modal from link in bootstrap dropdown )
                    //$(e.target).closest('.btn-group').children('.dropdown-toggle').dropdown('toggle');

                    $('#myModalContent')
                        .load(this.href,
                            function() {
                                $('#myModal')
                                    .modal({
                                            backdrop: 'static',
                                            keyboard: true
                                        },
                                        'show');
                                bindForm(this);
                            });
                    return false;
                });
    });

    function bindForm(dialog) {
        $('form', dialog)
            .submit(function() {
                $.ajax({

                        url: this.action,
                        type: this.method,
                        data: $(this).serialize(),
                        async: true,
                    })
                    .done(function(result) {
                        if (result.success) {

                            $('#myModal').modal('hide');
                            $('#' + result.tableId).load(result.url);
//  Load data from the server and place the returned HTML into the matched element
                            $.notify({
                                // options
                                icon: 'glyphicon glyphicon-ok',
                                title: '',
                                message: 'Your data added Successfuly',
                            },
                            {
                                type: "success",

                                placement: {
                                    from: "bottom ",
                                    align: "right"
                                }
                            });
                        } else {
                            $('#myModalContent').html(result);
                            bindForm(dialog);
                            $.notify({
                                // options
                                icon: 'glyphicon glyphicon-warnning',
                                title: '',
                                message: result.message,
                            },
                            {
                                type: "danger",

                                placement: {
                                    from: "bottom ",
                                    align: "right"
                                }
                            });
                        }
                    });
                return false;
            });
    }
</script>